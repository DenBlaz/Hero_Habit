{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calendar</title>
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans"
      rel="stylesheet"
    />
    <link
      rel="icon"
      href="{% static 'dashboard/image/logo_b.png' %}"
      type="image/png"
    />
    <link
      rel="stylesheet"
      href="{% static 'calend/css/calend-for-all.css' %}"
    />
  </head>
  <body>
    <div class="container">
      <div class="header1">
        <span><span class="bold">Hero</span>Habit</span>
      </div>

      <div class="header2">
        <div class="navigation">
          <ul>
            <li><a href="{% url 'dashboard:dashboard' %}">Dashboard</a></li>
            <li><a href="{% url 'stats:stats' %}">Statistics</a></li>
            <li>
              <a class="active-page" href="{% url 'calend:calend' %}"
                >Calendar</a
              >
            </li>
            <li><a href="{% url 'achievements:achiev' %}">Achievements</a></li>
          </ul>
        </div>
        <div class="settings">
          <button id="toggle-icon" class="icon">
            <img
              src="{% static 'calend/images/settings.svg' %}"
              height="30px"
            />
          </button>
          <div class="panel" id="toggle-panel">
            <div class="title-settings">
              <div class="title">
                <img
                  class="icon"
                  src="{% static 'calend/images/settings.svg' %}"
                  style="margin: 15px"
                />
                <p style="font-size: 34px; margin-top: 15px">Settings</p>
              </div>
              <a class="icon" id="close" style="margin: 15px">
                <img src="{% static 'calend/images/cross.svg' %}" />
              </a>
            </div>
            <div class="settings-container">
              <div class="settings-options">
                <ul class="options">
                  <li id="ViewProfileOption" class="option">Edit profile</li>
                  <li id="ChangePassword" class="option">Change password</li>
                </ul>
              </div>
              <div class="settings-profile-usage">
                <div class="settings-profile-section">
                  <p>Profile picture</p>
                  <img
                    style="padding: 2% 0 1% 0; width: 80px"
                    src="{% static 'calend/images/account.svg' %}"
                  />
                </div>
                <div
                  class="settings-username-section"
                  style="padding: 1% 0 3% 0"
                >
                  <p style="padding: 1% 0 1% 0">Username</p>
                  <input
                    placeholder="Username"
                    value="{{ request.user.nickname }}"
                  />
                </div>
                <div class="settings-email-settings" style="padding-bottom: 4%">
                  <p style="padding: 1% 0 1% 0">Email</p>
                  <input placeholder="Email" value="{{ request.user.email }}" />
                </div>
                <button class="settings-button">
                  <img
                    style="width: 14%"
                    src="{% static 'calend/images/pen.svg' %}"
                  />
                  Edit
                </button>
              </div>
              <div class="settings-change-password">
                <div
                  class="settings-password-section"
                  style="padding: 0 0 1.5% 0"
                >
                  <p style="padding: 0 0 1% 0">Current password</p>
                  <input type="password" placeholder="Password" />
                </div>
                <div class="settings-change-section">
                  <p style="padding: 2% 0 1% 0">New password</p>
                  <input type="password" placeholder="Password" />
                </div>
                <div class="settings-change-section" style="padding: 0 0 4% 0">
                  <p style="padding: 3% 0 1% 0">Confirm new password</p>
                  <input type="password" placeholder="Password" />
                </div>
                <button class="settings-button">
                  <img src="{% static 'calend/images/pen.svg' %}" /> Save
                </button>
              </div>
            </div>
          </div>
          <button id="open-modal" class="icon">
            <img src="{% static 'calend/images/account.svg' %}" height="40px" />
          </button>
          <div id="overlay"></div>
        </div>
      </div>

      <div class="content">
        <div class="manage-section rounded">
          <div class="left-layout">
            <div class="lil-calendar">
              <div class="lil-container">
                <button class="change-month">
                  <img
                    class="change-month-icon"
                    src="{% static 'calend/images/arrow2.svg' %}"
                  />
                </button>
                <p><strong>{% now "F Y" %}</strong></p>
                <button class="change-month">
                  <img
                    class="change-month-icon"
                    src="{% static 'calend/images/arrow1.svg' %}"
                  />
                </button>
              </div>
              <ul class="days" style="margin-top: 15px; margin-bottom: 10px">
                <li>Mon</li>
                <li>Tue</li>
                <li>Wed</li>
                <li>Thu</li>
                <li>Fri</li>
                <li>Sat</li>
                <li>Sun</li>
              </ul>
              <div class="dates selected-week">
                <button class="previous-month">30</button>
                <button class="previous-month">31</button>
                <button class="selected-day">1</button>
                <button>2</button>
                <button>3</button>
                <button>4</button>
                <button>5</button>
              </div>
              <div class="dates">
                <button>6</button><button>7</button><button>8</button>
                <button>9</button><button>10</button><button>11</button>
                <button>12</button>
              </div>
              <div class="dates">
                <button>13</button><button>14</button><button>15</button>
                <button>16</button><button>17</button><button>18</button>
                <button>19</button>
              </div>
              <div class="dates">
                <button>20</button><button>21</button><button>22</button>
                <button>23</button><button>24</button><button>25</button>
                <button>26</button>
              </div>
              <div class="dates">
                <button>27</button><button>28</button><button>29</button>
                <button>30</button><button>31</button>
                <button class="next-month">1</button>
                <button class="next-month">2</button>
              </div>
            </div>

            <div class="categories-section">
              <p
                style="
                  padding: 1px 1px 0 10px;
                  font-weight: 600;
                  font-size: 20px;
                "
              >
                <strong>Categories</strong>
              </p>
              <div class="category">
                <img src="{% static 'calend/images/pink-ellipse.svg' %}" />
                <p>Creativity</p>
              </div>
              <div class="category">
                <img src="{% static 'calend/images/green-ellipse.svg' %}" />
                <p>Strength</p>
              </div>
              <div class="category">
                <img src="{% static 'calend/images/blue-ellipse.svg' %}" />
                <p>Intelligence</p>
              </div>
            </div>

            <div class="button-section">
              <button class="invisible-button" id="addTaskButton">
                <img
                  src="{% static 'calend/images/plus.svg' %}"
                  style="padding: 0 10px 0 10px"
                />Add a task
              </button>
            </div>

            <form
              action="{% url 'calend:taskcreate' %}"
              method="post"
              id="taskForm"
            >
              {% csrf_token %}
              <input
                type="hidden"
                name="task_type"
                id="taskType"
                value="daily"
              />
              <div class="add-task" id="addTaskForm" style="display: none">
                <div class="title-task">
                  <p>Add a task</p>
                  <img
                    src="{% static 'calend/images/at-cross.svg' %}"
                    class="icon"
                    style="width: 23px"
                    onclick="document.getElementById('addTaskForm').style.display='none'"
                  />
                </div>
                <div class="at-work">
                  <p style="padding: 5px 0 5px 0">Title & Description</p>
                  <input
                    class="at-input"
                    name="title"
                    placeholder="New task title"
                    required
                  />
                  <input
                    class="at-input-i"
                    name="description"
                    placeholder="Description"
                    style="
                      background: url('{% static 'calend/images/lines-input.svg' %}')
                        no-repeat 8px 65%;
                    "
                  />

                  <p style="padding: 1px 0 0 0">Date & Time</p>
                  <!-- Due date field for DailyTask -->
                  <div id="dueDateSection">
                    <input
                      class="at-input-i"
                      id="toggleDate"
                      name="due_date"
                      placeholder="DD.MM.YYYY"
                      style="
                        margin: 10px 0 0 0;
                        background: url('{% static 'calend/images/date-icon.svg' %}')
                          no-repeat 8px center;
                      "
                    />
                  </div>

                  <!-- Block for DailyTask (day mode) -->
                  <div class="task-time" id="dateDay" style="margin-top: 5px">
                    <input
                      class="at-input-i"
                      name="start_time"
                      placeholder="00:00"
                      style="
                        background: url('{% static 'calend/images/clock-icon.svg' %}')
                          no-repeat 8px center;
                      "
                    />
                    <input
                      class="at-input-i"
                      name="finish_time"
                      placeholder="23:59"
                      style="
                        background: url('{% static 'calend/images/clock-icon.svg' %}')
                          no-repeat 8px center;
                      "
                    />
                  </div>

                  <!-- Block for LongTask (month mode) -->
                  <div
                    class="task-time1"
                    id="dateMonth"
                    style="margin-top: 5px; display: none"
                  >
                    <input
                      class="at-input-i"
                      name="start_date"
                      placeholder="DD.MM.YYYY"
                      style="
                        background: url('{% static 'calend/images/date-icon.svg' %}')
                          no-repeat 8px center;
                      "
                      required
                    />
                    <input
                      class="at-input-i"
                      name="finish_date"
                      placeholder="DD.MM.YYYY"
                      style="
                        background: url('{% static 'calend/images/date-icon.svg' %}')
                          no-repeat 8px center;
                      "
                      required
                    />
                  </div>

                  <p style="margin: 10px 0 0 0">Category</p>
                  <input
                    type="hidden"
                    name="characteristic"
                    id="characteristic"
                    value="Creativity"
                  />
                  <div class="change-stats">
                    <img
                      src="{% static 'calend/images/pink-ellipse.svg' %}"
                      data-category="Creativity"
                      data-chosen="{% static 'calend/images/Ch-R-ellipse.svg' %}"
                      data-default="{% static 'calend/images/pink-ellipse.svg' %}"
                      class="at-icon chosen"
                    />
                    <img
                      src="{% static 'calend/images/green-ellipse.svg' %}"
                      data-category="Strength"
                      data-chosen="{% static 'calend/images/Ch-Gr-ellipse.svg' %}"
                      data-default="{% static 'calend/images/green-ellipse.svg' %}"
                      class="at-icon"
                    />
                    <img
                      src="{% static 'calend/images/blue-ellipse.svg' %}"
                      data-category="Intelligence"
                      data-chosen="{% static 'calend/images/Ch-B-ellipse.svg' %}"
                      data-default="{% static 'calend/images/blue-ellipse.svg' %}"
                      class="at-icon"
                    />
                  </div>

                  <div class="buttons">
                    <button
                      type="button"
                      class="cancel-button"
                      style="margin-right: 10px"
                      onclick="document.getElementById('addTaskForm').style.display='none'"
                    >
                      Cancel
                    </button>
                    <button type="submit" class="save-button">Save</button>
                  </div>
                </div>
              </div>
            </form>

            <div class="show-month-tasks" id="toggleView">
              <button class="invisible-button" id="toggleButton">
                <img
                  id="toggleIcon"
                  style="padding: 0 22px 0 22px"
                  src="{% static 'calend/images/leftarrow.svg' %}"
                />
                <span id="toggleText">Show tasks for month</span>
              </button>
            </div>
          </div>
        </div>

        <!-- Calendar for days (DailyTask) -->
        <div class="calendar-section" id="calendarView">
          <div class="days-section">
            <div class="day" style="border-top-left-radius: 10px"></div>
            <button class="space" id="Monday">
              <div>Monday <strong>1</strong></div>
            </button>
            <button class="space" id="Tuesday">
              <div>Tuesday <strong>2</strong></div>
            </button>
            <button class="space" id="Wednesday">
              <div>Wednesday <strong>3</strong></div>
            </button>
            <button class="space" id="Thursday">
              <div>Thursday <strong>4</strong></div>
            </button>
            <button class="space" id="Friday">
              <div>Friday <strong>5</strong></div>
            </button>
            <button class="space" id="Saturday">
              <div>Saturday <strong>6</strong></div>
            </button>
            <button
              class="space"
              id="Sunday"
              style="border-top-right-radius: 10px"
            >
              <div>Sunday <strong>7</strong></div>
            </button>
          </div>
          <div class="time-section">
            <div class="time-column" id="time-column">
              <div class="time-slot">9 am</div>
              <div class="time-slot">10 am</div>
              <div class="time-slot">11 am</div>
              <div class="time-slot">12 am</div>
              <div class="time-slot">1 pm</div>
              <div class="time-slot">2 pm</div>
            </div>
            {% for day in "1234567" %}
            <div class="time-column">
              {% for task in daily_tasks %} {% if task.due_date|date:"j" == day
              %}
              <div
                class="side-bar {% if task.characteristic == 'Creativity' %}pink-bar{% elif task.characteristic == 'Strength' %}green-bar{% else %}blue-bar{% endif %}"
                style="top: {{ task.start_time|time:'H' }}%; height: {{ task.finish_time|time:'H'|add:task.start_time|time:'H'|add:'-1' }}%;"
              >
                <p class="semi-bold font16px">{{ task.title }}</p>
                <p class="font12px">
                  {{ task.start_time|time:"H:i" }} - {{
                  task.finish_time|time:"H:i" }}
                </p>
              </div>
              {% endif %} {% empty %}
              <!-- Если задач нет, ничего не отображаем -->
              {% endfor %}
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Calendar for months (LongTask) -->
        <div
          class="calendar-section1 rounded"
          id="taskView"
          style="display: none"
        >
          <div class="month-section">
            <div class="month">
              <div class="day-header"></div>
              {% for day in
              "12345678910111213141516171819202122232425262728293031" %}
              <div class="day-header">{{ day }}</div>
              {% endfor %}
            </div>
            <div class="month">
              {% for task in long_tasks %}
              <div
                class="long-task-bar {% if task.characteristic == 'Creativity' %}pink-bar{% elif task.characteristic == 'Strength' %}green-bar{% else %}blue-bar{% endif %}"
                style="left: {{ task.start_date|date:'j'|add:'-1' }}0%; width: {{ task.finish_date|date:'j'|add:1|add:task.start_date|date:'j'|add:'-1' }}0%;"
              >
                <p class="semi-bold font16px">{{ task.title }}</p>
                <span class="start-date"
                  >{{ task.start_date|date:"d.m.Y" }}</span
                >
                <span class="end-date"
                  >{{ task.finish_date|date:"d.m.Y" }}</span
                >
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <!-- Profile modal -->
      <div id="profile-modal" class="modal">
        <div class="modal-content rounded">
          <p>Account</p>
          <div class="flex-center">
            <img src="{% static 'calend/images/account.svg' %}" height="35px" />
            <div class="account-info light grey">
              <p>{{ request.user.nickname }}</p>
              <p>{{ request.user.email }}</p>
            </div>
          </div>
          <hr />
          <p>
            <a href="{% url 'accounts:logout' %}" class="inline log-out"
              >Log out<img
                src="{% static 'calend/images/logOutSign.svg' %}"
                height="25px"
            /></a>
          </p>
        </div>
      </div>
    </div>

    <script>
      // Show task creation form
      document
        .getElementById("addTaskButton")
        .addEventListener("click", function () {
          document.getElementById("addTaskForm").style.display = "block";
        });

      // Category selection
      document.querySelectorAll(".change-stats img").forEach(function (img) {
        img.addEventListener("click", function () {
          document.querySelectorAll(".change-stats img").forEach(function (i) {
            i.classList.remove("chosen");
            i.src = i.getAttribute("data-default");
          });
          this.classList.add("chosen");
          this.src = this.getAttribute("data-chosen");
          document.getElementById("characteristic").value =
            this.getAttribute("data-category");
        });
      });

      // Calendar mode switching
      const toggleButton = document.getElementById("toggleButton");
      const toggleIcon = document.getElementById("toggleIcon");
      const toggleText = document.getElementById("toggleText");
      const dateDay = document.getElementById("dateDay");
      const dateMonth = document.getElementById("dateMonth");
      const dueDateSection = document.getElementById("dueDateSection");
      const dueDateInput = document.getElementById("toggleDate");
      const taskType = document.getElementById("taskType");
      const calendarView = document.getElementById("calendarView");
      const taskView = document.getElementById("taskView");
      let currentMode = "day";

      toggleButton.addEventListener("click", function () {
        if (currentMode === "day") {
          currentMode = "month";
          toggleText.textContent = "Show tasks for day";
          toggleIcon.src = '{% static "calend/images/rightarrow.svg" %}';
          dateDay.style.display = "none";
          dateMonth.style.display = "block";
          dueDateSection.style.display = "none";
          dueDateInput.removeAttribute("required");
          taskType.value = "long";
          calendarView.style.display = "none";
          taskView.style.display = "block";
        } else {
          currentMode = "day";
          toggleText.textContent = "Show tasks for month";
          toggleIcon.src = '{% static "calend/images/leftarrow.svg" %}';
          dateDay.style.display = "block";
          dateMonth.style.display = "none";
          dueDateSection.style.display = "block";
          dueDateInput.setAttribute("required", "");
          taskType.value = "daily";
          calendarView.style.display = "block";
          taskView.style.display = "none";
        }
      });

      // Set initial mode
      function setTaskMode(mode) {
        if (mode === "month") {
          dateDay.style.display = "none";
          dateMonth.style.display = "block";
          dueDateSection.style.display = "none";
          dueDateInput.removeAttribute("required");
          taskType.value = "long";
          toggleText.textContent = "Show tasks for day";
          toggleIcon.src = '{% static "calend/images/rightarrow.svg" %}';
          calendarView.style.display = "none";
          taskView.style.display = "block";
        } else {
          dateDay.style.display = "block";
          dateMonth.style.display = "none";
          dueDateSection.style.display = "block";
          dueDateInput.setAttribute("required", "");
          taskType.value = "daily";
          toggleText.textContent = "Show tasks for month";
          toggleIcon.src = '{% static "calend/images/leftarrow.svg" %}';
          calendarView.style.display = "block";
          taskView.style.display = "none";
        }
      }
      setTaskMode(currentMode);

      // Settings and profile modal
      document
        .getElementById("toggle-icon")
        .addEventListener("click", function () {
          document.getElementById("toggle-panel").style.display = "block";
        });
      document.getElementById("close").addEventListener("click", function () {
        document.getElementById("toggle-panel").style.display = "none";
      });
      document
        .getElementById("open-modal")
        .addEventListener("click", function () {
          document.getElementById("profile-modal").style.display = "block";
        });
    </script>
  </body>
</html>
